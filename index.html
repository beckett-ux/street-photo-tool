// Reorder queued photos based on an array of relPath values
app.post('/api/reorder-photos', (req, res) => {
  const { order } = req.body || {};
  if (!Array.isArray(order)) {
    return res.status(400).json({ error: 'Missing order array' });
  }

  // Map relPath list to absolute paths
  const relToAbs = rel => path.normalize(path.join(WATCH_DIR, rel));

  const newQueued = [];
  order.forEach(rel => {
    const abs = relToAbs(rel);
    const found = queuedFiles.find(p => path.normalize(p) === abs);
    if (found) {
      newQueued.push(found);
    }
  });

  if (!newQueued.length) {
    console.warn('Reorder request did not match any queued files');
    return res.status(400).json({ error: 'Reorder did not match current queue' });
  }

  if (newQueued.length !== queuedFiles.length) {
    console.warn('Reorder did not include all queued files, appending leftovers at end');
    const leftovers = queuedFiles.filter(p => !newQueued.includes(p));
    queuedFiles = newQueued.concat(leftovers);
  } else {
    queuedFiles = newQueued;
  }

  res.json({ ok: true });
});
